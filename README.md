# cov-visualizer

Coverage and CFG visualization webapp for C/C++ projects.

## How to Use

### Generate Coverage Data

This project reads coverage reports that are generated by `llvm-cov`. To instrument your C/C++ project and generate coverage data follow the steps here: https://clang.llvm.org/docs/SourceBasedCodeCoverage.html
After a `profdata` file is generated, this project requires you to dump it into JSON format using the following command:

```bash
llvm-cov export -format=text <path-to-instrumented-binary> --instr-profile <path-to-profdata-file> > cov.json
```

### Generate CFG Data

We use an LLVM-12 based plugin to dump CFG information. If your distribution does not provide LLVM-12, you can build it from source (https://github.com/llvm/llvm-project) by checking out release/12.x branch and using `gcc-9` to build it.

First initialize the submodule:

```bash
git submodule update --init --recursive
```

Then build the plugin and link it with LLVM-12:

```bash
cd llvm-cfg-to-json
mkdir build && cd build
CC=gcc-9 CXX=g++-9 cmake ../ -DLLVM_DIR=`/path/to/llvm-config-12 --cmakedir`
```

Then build your project with the plugin (for example using `make`):

```bash
CC=/path/to/clang-12 CXX=/path/to/clang-12 \
CXX=/path/to/clang-12 CXX=/path/to/clang++-12 \
CFLAGS="-fplugin=/path/to/cov-visualizer/llvm-cfg-to-json/build/libLLVMCFGToJSON.so -O0 -g" \
CXXFLAGS="-fplugin=/path/to/cov-visualizer/llvm-cfg-to-json/build/libLLVMCFGToJSON.so -O0 -g" make
```

Note that the `-O0 -g` flags must be set for LLVM to emit line number information in its IR.

CFGs will be generated and stored in `cfg.<source-file-name>.json` files.

### Using the backend

```bash
cd backend
python3 -m venv venv
source venv/bin/activate
pip install -r requirements.txt
python3 server.py
```

### Using the frontend

```bash
cd frontend
npm install
npm run dev
```
